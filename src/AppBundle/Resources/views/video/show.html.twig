{% extends 'AppBundle::base.html.twig' %}

{% block title %}{{ video.title }} | {{ video.user.username }} - {% endblock %}

{% block content %}
    <div id="player" class="col-lg-12">
        <video controls class="col-lg-8 offset-lg-2">
            <source src="{{ asset(videos_directory ~ video.video) }}" type="video/mp4">
            Your browser does not support the video tag.
        </video>
    </div>

    <div id="info-video" class="col-lg-12">
        <div id="top-video" class="row">
            <span id="title-video" class="col-lg-2">{{ video.title }}</span>
            <span id="views-video" class="col-lg-2 offset-lg-8">{{ video.nbViews }} views</span>
        </div>

        <p id="user-video">{{ video.user.username }}</p>
        <p id="description-video">{{ video.description }}</p>
    </div>

    <div id="add-comment-video" class="col-lg-12">
        {% if app.user %}
            {{ form_start(commentForm, {attr: {id: 'comment-form'} }) }}
            {{ form_widget(commentForm) }}
            {{ form_end(commentForm) }}
        {% endif %}
    </div>

    <div id="comments-video" class="col-lg-12">
        {% for comment in comments %}
            <div class="comment">
                <span class="username-comment">{{ comment.user.username }}</span><span class="date-comment">{{ comment.datetime|date("d-m-Y H:i", "Europe/Paris") }}</span><br>
                <p class="body-comment">{{ comment.text }}</p>
            </div>
        {% endfor %}
    </div>
{% endblock %}

{% block javascripts %}
    <script type="text/javascript">
        $('#comment-form').on('submit', function(e) {

            e.preventDefault();

            var url = "{{ path('comment_new', {'video_id': video.id}) }}";
            var formSerialize = $(this).serialize();

            $.post(url, formSerialize, function(response) {
                console.log(response);

                var comments = document.getElementById('comments-video');

                var comment = document.createElement("div");
                comment.className += "comment";

                var username = document.createElement("span");
                username.className += "username-comment";
                username.innerHTML = response.user.username;
                comment.appendChild(username);

                var date = document.createElement("span");
                date.className += "date-comment";
                var datetime = new Date(response.datetime.date);
                date.innerHTML = datetime.toLocaleString();
                comment.appendChild(date);

                var body = document.createElement("p");
                body.className += "body-comment";
                body.innerHTML = response.text;
                comment.appendChild(body);

                comments.prepend(comment);

            }, 'json');

            return false;
        });
    </script>
{% endblock %}